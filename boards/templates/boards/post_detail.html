{% extends "base.html" %}
{% load static %}
{% block css %}
  <link rel="stylesheet" href="{% static 'css/post-detail.css' %}">
{% endblock css %}
{% block content %}
  <div id="post-container">
    <h2 id="post-title"></h2>
    <div id="post-meta">
      <span id="post-author"></span> | <span id="post-created-at"></span>
    </div>
    <div id="post-content"></div>
  </div>
  <div id="error-message"></div>
{% endblock content %}
{% block javascript %}
  <script>
    // URL에서 게시글 ID를 추출하는 함수
    function getPostIdFromURL() {
      const urlParts = window.location.pathname.split('/');
      // URL 형식: /board/posts/{post_id}/
      const postId = urlParts[urlParts.length - 2]; // 마지막 요소는 빈 문자열이므로 -2 사용
      return postId;
    }

    async function fetchPost() {
      const postId = getPostIdFromURL();
      try {
        const response = await fetch(`/api/board/posts/${postId}/`, {
          method: 'GET',
          credentials: 'include', // 쿠키 포함
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const post = await response.json();
          renderPost(post);
        } else if (response.status === 401) {
          throw new Error('인증 실패: 로그인 상태를 확인해주세요.');
        } else if (response.status === 404) {
          throw new Error('게시글을 찾을 수 없습니다.');
        } else {
          throw new Error('게시글 불러오기 실패');
        }
      } catch (error) {
        console.error('Error:', error);
        alert(error.message);
      }
    }

    function renderPost(post) {
      const titleElement = document.getElementById('post-title');
      const contentElement = document.getElementById('post-content');
      const authorElement = document.getElementById('post-author');
      const createdAtElement = document.getElementById('post-created-at');
    
      titleElement.textContent = post.title;
      contentElement.innerHTML = post.content; // HTML 포함 가능성 있으므로 innerHTML 사용
    
      // 작성자 표시
      authorElement.textContent = `작성자: ${post.author}`;
    
      // 작성일 표시 (날짜 포맷 변환)
      const createdDate = new Date(post.created_at);
      createdAtElement.textContent = `작성일: ${createdDate.toLocaleString()}`;
    }
    

    // 페이지 로드 시 게시글 데이터 가져오기
    fetchPost();
  </script>
{% endblock javascript %}
