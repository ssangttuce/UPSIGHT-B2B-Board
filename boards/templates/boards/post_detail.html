{% extends "base.html" %}
{% block content %}
  <h2 id="post-title"></h2>
  <div id="post-content"></div>
{% endblock content %}
{% block javascript %}
  <script>
    // URL에서 게시글 ID를 추출하는 함수
    function getPostIdFromURL() {
      const urlParts = window.location.pathname.split('/');
      // URL 형식: /board/posts/{post_id}/
      const postId = urlParts[urlParts.length - 2]; // 마지막 요소는 빈 문자열이므로 -2 사용
      return postId;
    }

    async function fetchPost() {
      const postId = getPostIdFromURL();
      try {
        const response = await fetch(`/api/board/posts/${postId}/`, {
          method: 'GET',
          credentials: 'include', // 쿠키 포함
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const post = await response.json();
          renderPost(post);
        } else if (response.status === 401) {
          throw new Error('인증 실패: 로그인 상태를 확인해주세요.');
        } else if (response.status === 404) {
          throw new Error('게시글을 찾을 수 없습니다.');
        } else {
          throw new Error('게시글 불러오기 실패');
        }
      } catch (error) {
        console.error('Error:', error);
        alert(error.message);
      }
    }

    function renderPost(post) {
      const titleElement = document.getElementById('post-title');
      const contentElement = document.getElementById('post-content');

      titleElement.textContent = post.title;
      contentElement.innerHTML = post.content; // content에 HTML이 포함될 수 있으므로 innerHTML 사용

      // 만약 content가 단순 텍스트라면, 아래 코드를 사용하세요.
      // contentElement.textContent = post.content;
    }

    // 페이지 로드 시 게시글 데이터 가져오기
    fetchPost();
  </script>
{% endblock javascript %}
